import{d as ne,i as c,E as F,j as ie,z as b,c as A,a as l,e as n,u as a,g as f,w as r,s as y,o as p,t as u,k as C,l as g,F as re,r as ue,n as W,q as N,I as E,f as de,m as me,S as ce}from"./index-D8589wv1.js";import{s as P}from"./index-ClrqVXkq.js";import{s as G}from"./index-6CTq7M7X.js";import{s as pe,a as M}from"./index-Dh5r2--x.js";import{s as ve}from"./index-jScag9qz.js";import{s as fe,a as K}from"./index-C13dDCzX.js";import"./index-Bm-YCIKJ.js";import"./index-BinFA1H_.js";import"./index-BLAybKhr.js";import"./index-DD1gTuyr.js";const ye={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},ge={class:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6"},xe={class:"text-center"},be={class:"text-3xl font-bold text-violet-600"},we={class:"text-center"},he={class:"text-3xl font-bold text-blue-600"},ke={class:"text-center"},Ve={class:"text-3xl font-bold text-green-600"},Ce={class:"text-center"},Me={class:"text-3xl font-bold text-red-600"},De={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},_e={class:"text-gray-900"},Se={class:"space-y-3"},Ae={class:"flex items-center space-x-4"},Ne={class:"text-center min-w-[60px]"},Pe={class:"text-lg font-bold text-violet-600"},Ee={class:"font-medium text-gray-900"},$e={class:"text-sm text-gray-600"},Ue={class:"flex items-center space-x-2"},Ie={key:0,class:"text-center py-8 text-gray-500"},Te={class:"flex flex-col sm:flex-row gap-4"},Le={class:"flex-1"},Fe={class:"p-input-icon-left w-full"},ze={class:"font-medium text-gray-900"},Oe={class:"text-sm text-violet-600"},He={class:"font-medium text-gray-900"},Be={class:"text-sm text-gray-600"},qe={class:"flex gap-1"},je={class:"space-y-4"},Je={class:"grid grid-cols-2 gap-4"},Qe={class:"col-span-2"},We={class:"grid grid-cols-2 gap-4"},Ge={class:"grid grid-cols-2 gap-4"},Ke={key:0},it=ne({__name:"AppointmentsPage",setup(Re){const D=c(!1),w=c([]),h=c(""),d=c(null),k=c(null),x=c(!1),V=c(!1),m=c(""),$=c([]),U=c([]),z=[{label:"All Statuses",value:null},{label:"Scheduled",value:"scheduled"},{label:"Confirmed",value:"confirmed"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],R=["8:00 AM","8:30 AM","9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM"],O={id:"",customerName:"",customerEmail:"",customerPhone:"",service:"",employee:"",date:new Date,time:"9:00 AM",duration:45,status:"scheduled",notes:""},o=c({...O}),I=F(()=>{let s=w.value;if(h.value){const e=h.value.toLowerCase();s=s.filter(i=>i.customerName.toLowerCase().includes(e)||i.customerEmail.toLowerCase().includes(e)||i.service.toLowerCase().includes(e)||i.employee.toLowerCase().includes(e))}if(d.value){const e=d.value.toDateString();s=s.filter(i=>new Date(i.date).toDateString()===e)}return k.value&&(s=s.filter(e=>e.status===k.value)),s}),T=F(()=>{const s=new Date().toDateString();return w.value.filter(e=>new Date(e.date).toDateString()===s)}),X=F(()=>{const s=new Date;return s.setHours(0,0,0,0),w.value.filter(e=>new Date(e.date)>=s&&e.status!=="completed"&&e.status!=="cancelled").sort((e,i)=>new Date(e.date).getTime()-new Date(i.date).getTime())});function H(s){return new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}function B(s){return{scheduled:"bg-blue-100 text-blue-700",confirmed:"bg-green-100 text-green-700",completed:"bg-gray-100 text-gray-700",cancelled:"bg-red-100 text-red-700","no-show":"bg-orange-100 text-orange-700"}[s]||"bg-gray-100 text-gray-700"}function Y(){o.value={...O,id:crypto.randomUUID(),date:new Date},V.value=!1,x.value=!0,m.value=""}function q(s){o.value={...s,date:new Date(s.date)},V.value=!0,x.value=!0,m.value=""}async function Z(){if(!o.value.customerName||!o.value.service||!o.value.employee){m.value="Please fill in all required fields";return}try{D.value=!0,m.value="";const s=U.value.find(t=>t.value===o.value.service),e=$.value.find(t=>t.value===o.value.employee);if(!s||!e){m.value="Invalid service or employee selection";return}const i=ee(o.value.date,o.value.time);if(V.value){const t={customerName:o.value.customerName,customerEmail:o.value.customerEmail||void 0,customerPhone:o.value.customerPhone||void 0,employeeId:e.id,startTime:i.toISOString(),notes:o.value.notes||void 0,status:o.value.status,tenantId:j()};(await b.patch(`/api/appointments/${o.value.id}`,t)).data.success&&(await _(),x.value=!1)}else{const t={customerName:o.value.customerName,customerEmail:o.value.customerEmail||void 0,customerPhone:o.value.customerPhone||void 0,serviceId:s.id,employeeId:e.id,startTime:i.toISOString(),notes:o.value.notes||void 0,addOns:[]};(await b.post("/api/appointments",t)).data.success&&(await _(),x.value=!1)}}catch(s){console.error("Error saving appointment:",s),m.value=s.response?.data?.error||"Failed to save appointment"}finally{D.value=!1}}function ee(s,e){const i=e.split(" "),t=i[0],v=i[1];if(!t)throw new Error("Time must be in format HH:MM AM/PM (e.g., 9:00 AM)");const L=t.split(":");if(L.length!==2)throw new Error("Time must be in format HH:MM AM/PM (e.g., 9:00 AM)");let S=parseInt(L[0]||"0",10);const oe=parseInt(L[1]||"0",10);v==="PM"&&S!==12?S+=12:v==="AM"&&S===12&&(S=0);const Q=new Date(s);return Q.setHours(S,oe,0,0),Q}function j(){const s=localStorage.getItem("token");if(!s)return null;try{const e=s.split(".");if(e.length!==3||!e[1])return null;let i=e[1].replace(/-/g,"+").replace(/_/g,"/");const t=(4-i.length%4)%4;return i=i.padEnd(i.length+t,"="),JSON.parse(atob(i)).tenantId||null}catch(e){return console.error("Error parsing JWT token:",e),null}}async function J(s,e){try{const i={status:e,tenantId:j()};(await b.patch(`/api/appointments/${s.id}`,i)).data.success&&await _()}catch(i){console.error("Error updating appointment status:",i),m.value="Failed to update appointment status"}}async function te(s){if(confirm(`Are you sure you want to cancel the appointment for ${s.customerName}?`))try{(await b.delete(`/api/appointments/${s.id}`)).data.success&&await _()}catch(e){console.error("Error cancelling appointment:",e),m.value="Failed to cancel appointment"}}function le(){h.value="",d.value=null,k.value=null}ie(async()=>{D.value=!0;try{await Promise.all([_(),se(),ae()])}catch(s){console.error("Error loading data:",s),m.value="Failed to load appointments data"}finally{D.value=!1}});async function _(){try{const s=await b.get("/api/appointments");s.data.success&&s.data.data&&(w.value=s.data.data.appointments.map(e=>({id:e.id,customerName:e.customerName||"Unknown",customerEmail:e.customerEmail||"",customerPhone:e.customerPhone||"",service:e.service?.name||"Unknown Service",serviceId:e.serviceId,employee:e.employee?`${e.employee.firstName} ${e.employee.lastName}`:"Unknown",employeeId:e.employeeId,date:new Date(e.startTime),time:new Date(e.startTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),duration:e.duration||e.totalDuration||30,status:e.status||"scheduled",notes:e.notes||""})))}catch(s){console.error("Error fetching appointments:",s)}}async function se(){try{const s=await b.get("/api/employees");s.data.success&&s.data.data&&($.value=s.data.data.employees.map(e=>({label:`${e.firstName} ${e.lastName}`,value:`${e.firstName} ${e.lastName}`,id:e.id})))}catch(s){console.error("Error fetching employees:",s)}}async function ae(){try{const s=await b.get("/api/services");s.data.success&&s.data.data&&(U.value=s.data.data.services.map(e=>({label:e.name,value:e.name,id:e.id,duration:e.duration})))}catch(s){console.error("Error fetching services:",s)}}return(s,e)=>{const i=ce("tooltip");return p(),A("div",null,[l("div",ye,[e[15]||(e[15]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900"},"Appointments"),l("p",{class:"text-gray-600 mt-1"},"Manage your appointments calendar and bookings")],-1)),n(a(f),{label:"New Appointment",icon:"pi pi-plus",class:"mt-4 sm:mt-0",onClick:Y})]),l("div",ge,[n(a(y),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",xe,[l("p",be,u(T.value.length),1),e[16]||(e[16]=l("p",{class:"text-sm text-gray-600"},"Today",-1))])]),_:1}),n(a(y),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",we,[l("p",he,u(X.value.length),1),e[17]||(e[17]=l("p",{class:"text-sm text-gray-600"},"Upcoming",-1))])]),_:1}),n(a(y),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",ke,[l("p",Ve,u(w.value.filter(t=>t.status==="completed").length),1),e[18]||(e[18]=l("p",{class:"text-sm text-gray-600"},"Completed",-1))])]),_:1}),n(a(y),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",Ce,[l("p",Me,u(w.value.filter(t=>t.status==="cancelled").length),1),e[19]||(e[19]=l("p",{class:"text-sm text-gray-600"},"Cancelled",-1))])]),_:1})]),n(a(fe),null,{default:r(()=>[n(a(K),{value:"0",header:"Calendar View"},{default:r(()=>[l("div",De,[n(a(y),{class:"shadow-sm bg-white"},{content:r(()=>[n(a(G),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),inline:"",class:"w-full",manualInput:!1},null,8,["modelValue"]),d.value?(p(),C(a(f),{key:0,label:"Clear Date",text:"",size:"small",class:"mt-2 w-full text-emerald-600",onClick:e[1]||(e[1]=t=>d.value=null)})):g("",!0)]),_:1}),n(a(y),{class:"shadow-sm lg:col-span-2 bg-white"},{title:r(()=>[l("span",_e,u(d.value?H(d.value):"Today's")+" Appointments",1)]),content:r(()=>[l("div",Se,[(p(!0),A(re,null,ue(d.value?I.value:T.value,t=>(p(),A("div",{key:t.id,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[l("div",Ae,[l("div",Ne,[l("p",Pe,u(t.time),1)]),l("div",null,[l("p",Ee,u(t.customerName),1),l("p",$e,u(t.service)+" with "+u(t.employee),1)])]),l("div",Ue,[l("span",{class:W(["px-2 py-1 rounded-full text-xs font-medium",B(t.status)])},u(t.status),3),n(a(f),{icon:"pi pi-pencil",text:"",size:"small",severity:"secondary",onClick:v=>q(t)},null,8,["onClick"])])]))),128)),(d.value?I.value:T.value).length===0?(p(),A("div",Ie," No appointments for this day ")):g("",!0)])]),_:1})])]),_:1}),n(a(K),{value:"1",header:"List View"},{default:r(()=>[n(a(y),{class:"mb-6 shadow-sm bg-white"},{content:r(()=>[l("div",Te,[l("div",Le,[l("span",Fe,[e[20]||(e[20]=l("i",{class:"pi pi-search"},null,-1)),n(a(N),{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),placeholder:"Search appointments...",class:"w-full"},null,8,["modelValue"])])]),n(a(P),{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),options:z,optionLabel:"label",optionValue:"value",placeholder:"Filter by status",class:"w-full sm:w-48"},null,8,["modelValue"]),h.value||k.value?(p(),C(a(f),{key:0,label:"Clear",text:"",severity:"secondary",onClick:le})):g("",!0)])]),_:1}),n(a(y),{class:"shadow-sm bg-white"},{content:r(()=>[n(a(pe),{value:I.value,loading:D.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20],responsiveLayout:"scroll",class:"p-datatable-sm",sortField:"date",sortOrder:-1},{empty:r(()=>[...e[21]||(e[21]=[l("div",{class:"text-center py-8 text-gray-500"}," No appointments found ",-1)])]),default:r(()=>[n(a(M),{field:"date",header:"Date",sortable:""},{body:r(({data:t})=>[l("div",null,[l("p",ze,u(H(t.date)),1),l("p",Oe,u(t.time),1)])]),_:1}),n(a(M),{field:"customerName",header:"Customer",sortable:""},{body:r(({data:t})=>[l("div",null,[l("p",He,u(t.customerName),1),l("p",Be,u(t.customerPhone),1)])]),_:1}),n(a(M),{field:"service",header:"Service",sortable:""}),n(a(M),{field:"employee",header:"Employee",sortable:""}),n(a(M),{field:"status",header:"Status",sortable:""},{body:r(({data:t})=>[l("span",{class:W(["px-2 py-1 rounded-full text-xs font-medium capitalize",B(t.status)])},u(t.status),3)]),_:1}),n(a(M),{header:"Actions",exportable:!1,style:{"min-width":"12rem"}},{body:r(({data:t})=>[l("div",qe,[t.status==="scheduled"?E((p(),C(a(f),{key:0,icon:"pi pi-check",text:"",size:"small",severity:"success",onClick:v=>J(t,"confirmed")},null,8,["onClick"])),[[i,"Confirm",void 0,{top:!0}]]):g("",!0),t.status==="confirmed"?E((p(),C(a(f),{key:1,icon:"pi pi-check-circle",text:"",size:"small",severity:"success",onClick:v=>J(t,"completed")},null,8,["onClick"])),[[i,"Complete",void 0,{top:!0}]]):g("",!0),E(n(a(f),{icon:"pi pi-pencil",text:"",size:"small",severity:"secondary",onClick:v=>q(t)},null,8,["onClick"]),[[i,"Edit",void 0,{top:!0}]]),t.status!=="cancelled"&&t.status!=="completed"?E((p(),C(a(f),{key:2,icon:"pi pi-times",text:"",size:"small",severity:"danger",onClick:v=>te(t)},null,8,["onClick"])),[[i,"Cancel",void 0,{top:!0}]]):g("",!0)])]),_:1})]),_:1},8,["value","loading"])]),_:1})]),_:1})]),_:1}),n(a(ve),{visible:x.value,"onUpdate:visible":e[14]||(e[14]=t=>x.value=t),header:V.value?"Edit Appointment":"New Appointment",modal:!0,style:{width:"600px"}},{footer:r(()=>[n(a(f),{label:"Cancel",text:"",severity:"secondary",onClick:e[13]||(e[13]=t=>x.value=!1)}),n(a(f),{label:V.value?"Update":"Book",onClick:Z},null,8,["label"])]),default:r(()=>[m.value?(p(),C(a(me),{key:0,severity:"error",class:"mb-4"},{default:r(()=>[de(u(m.value),1)]),_:1})):g("",!0),l("div",je,[l("div",Je,[l("div",Qe,[e[22]||(e[22]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Customer Name *",-1)),n(a(N),{modelValue:o.value.customerName,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.customerName=t),class:"w-full"},null,8,["modelValue"])]),l("div",null,[e[23]||(e[23]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),n(a(N),{modelValue:o.value.customerEmail,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.customerEmail=t),type:"email",class:"w-full"},null,8,["modelValue"])]),l("div",null,[e[24]||(e[24]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Phone",-1)),n(a(N),{modelValue:o.value.customerPhone,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.customerPhone=t),class:"w-full"},null,8,["modelValue"])])]),l("div",We,[l("div",null,[e[25]||(e[25]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Service *",-1)),n(a(P),{modelValue:o.value.service,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.service=t),options:U.value,optionLabel:"label",optionValue:"value",placeholder:"Select service",class:"w-full"},null,8,["modelValue","options"])]),l("div",null,[e[26]||(e[26]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Employee *",-1)),n(a(P),{modelValue:o.value.employee,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.employee=t),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"Select employee",class:"w-full"},null,8,["modelValue","options"])])]),l("div",Ge,[l("div",null,[e[27]||(e[27]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date *",-1)),n(a(G),{modelValue:o.value.date,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.date=t),class:"w-full",dateFormat:"mm/dd/yy"},null,8,["modelValue"])]),l("div",null,[e[28]||(e[28]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Time *",-1)),n(a(P),{modelValue:o.value.time,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.time=t),options:R,placeholder:"Select time",class:"w-full"},null,8,["modelValue"])])]),V.value?(p(),A("div",Ke,[e[29]||(e[29]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),n(a(P),{modelValue:o.value.status,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.status=t),options:z.filter(t=>t.value),optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"])])):g("",!0),l("div",null,[e[30]||(e[30]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),n(a(N),{modelValue:o.value.notes,"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.notes=t),class:"w-full",placeholder:"Any special requests or notes..."},null,8,["modelValue"])])])]),_:1},8,["visible","header"])])}}});export{it as default};
