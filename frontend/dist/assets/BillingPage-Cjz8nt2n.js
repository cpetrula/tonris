import{d as O,i as f,E as h,j as W,c as p,a as e,k as V,l as k,w as m,u as v,m as X,e as x,s as E,z as T,o as u,f as o,t as g,g as _,n as Y}from"./index-BrL85Hb2.js";var D="clover",H=function(i){return i===3?"v3":i},M="https://js.stripe.com",K="".concat(M,"/").concat(D,"/stripe.js"),Q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Z=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var ee=function(i){return Q.test(i)||Z.test(i)},te=function(){for(var i=document.querySelectorAll('script[src^="'.concat(M,'"]')),r=0;r<i.length;r++){var a=i[r];if(ee(a.src))return a}return null},B=function(i){var r="",a=document.createElement("script");a.src="".concat(K).concat(r);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(a),a},se=function(i,r){!i||!i._registerWrapper||i._registerWrapper({name:"stripe-js",version:"8.6.0",startTime:r})},w=null,P=null,j=null,re=function(i){return function(r){i(new Error("Failed to load Stripe.js",{cause:r}))}},ie=function(i,r){return function(){window.Stripe?i(window.Stripe):r(new Error("Stripe.js not available"))}},ae=function(i){return w!==null?w:(w=new Promise(function(r,a){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var n=te();if(!(n&&i)){if(!n)n=B(i);else if(n&&j!==null&&P!==null){var d;n.removeEventListener("load",j),n.removeEventListener("error",P),(d=n.parentNode)===null||d===void 0||d.removeChild(n),n=B(i)}}j=ie(r,a),P=re(a),n.addEventListener("load",j),n.addEventListener("error",P)}catch(l){a(l);return}}),w.catch(function(r){return w=null,Promise.reject(r)}))},ne=function(i,r,a){if(i===null)return null;var n=r[0],d=n.match(/^pk_test/),l=H(i.version),y=D;d&&l!==y&&console.warn("Stripe.js@".concat(l," was loaded on the page, but @stripe/stripe-js@").concat("8.6.0"," expected Stripe.js@").concat(y,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var b=i.apply(void 0,r);return se(b,a),b},S,$=!1,G=function(){return S||(S=ae(null).catch(function(i){return S=null,Promise.reject(i)}),S)};Promise.resolve().then(function(){return G()}).catch(function(c){$||console.warn(c)});var le=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];$=!0;var n=Date.now();return G().then(function(d){return ne(d,r,n)})};const oe={key:1,class:"text-center py-12"},ce={key:2},ue={class:"text-center py-8"},de={class:"text-gray-600 mb-6"},pe={class:"max-w-md mx-auto"},me={class:"border-2 rounded-xl p-6 mb-6"},ve={class:"mb-4"},ge={class:"text-3xl font-bold text-gray-900"},xe={key:3,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},fe={class:"flex items-center justify-between"},ye={key:0,class:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg"},be={class:"flex items-start"},he={class:"text-sm text-blue-700"},we={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},Se={class:"text-gray-500"},ke={key:0,class:"mt-4 md:mt-0 text-right"},Ee={class:"text-sm text-gray-500"},_e={class:"font-medium text-gray-900"},Pe={class:"mt-6 flex gap-3"},je={key:0,class:"text-center py-4"},Ce={key:1,class:"text-center py-4"},Le={key:2,class:"text-center py-4 text-gray-500"},Ae={class:"flex items-center justify-between"},Te=O({__name:"BillingPage",setup(c){const i=f(!1),r=f(""),a=f(null),n=f([]),d=f(15),l=f(!1),y=h(()=>a.value?.isActive||!1),b=h(()=>a.value?.status==="trialing"),C=h(()=>a.value?.isInactive||!1),q=h(()=>{if(!a.value)return"No subscription";const s=a.value.status;return{trialing:"Free Trial",active:"Active",past_due:"Past Due",canceled:"Cancelled",unpaid:"Unpaid",incomplete:"Incomplete",incomplete_expired:"Expired",inactive:"Inactive"}[s]||s}),N=h(()=>!a.value||!n.value.length||!n.value[0]?295:n.value[0].price/100);function R(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}function z(s){return{trialing:"bg-blue-100 text-blue-700",active:"bg-green-100 text-green-700",past_due:"bg-yellow-100 text-yellow-700",canceled:"bg-red-100 text-red-700",unpaid:"bg-red-100 text-red-700",incomplete:"bg-yellow-100 text-yellow-700",incomplete_expired:"bg-red-100 text-red-700",inactive:"bg-gray-100 text-gray-700"}[s]||"bg-gray-100 text-gray-700"}async function F(){try{i.value=!0,r.value="";const s=await T.get("/api/billing/subscription");s.data.success&&(a.value=s.data.data.subscription,n.value=s.data.data.plans.monthly?[s.data.data.plans.monthly]:[],d.value=s.data.data.trialDays||15)}catch(s){if(console.error("Failed to fetch subscription:",s),s&&typeof s=="object"&&"response"in s){const t=s;r.value=t.response?.data?.error||"Failed to load subscription information"}else r.value="Failed to load subscription information"}finally{i.value=!1}}async function L(){try{l.value=!0,r.value="";const s=window.location.href,t=await T.post("/api/billing/portal-session",{returnUrl:s});t.data.success&&t.data.data.url&&(window.location.href=t.data.data.url)}catch(s){if(console.error("Failed to open portal:",s),s&&typeof s=="object"&&"response"in s){const t=s;r.value=t.response?.data?.error||"Failed to open billing portal"}else r.value="Failed to open billing portal";l.value=!1}}async function J(){try{l.value=!0,r.value="";const s=`${window.location.origin}/app/billing?success=true`,t=`${window.location.origin}/app/billing?cancelled=true`,A=await T.post("/api/billing/create-checkout-session",{billingInterval:"month",successUrl:s,cancelUrl:t});if(A.data.success&&A.data.data.sessionId){const U=await le("");if(U){const I=await U.redirectToCheckout({sessionId:A.data.data.sessionId});I&&I.error&&(r.value=I.error.message||"Failed to redirect to checkout",l.value=!1)}else r.value="Stripe is not configured",l.value=!1}}catch(s){if(console.error("Failed to start checkout:",s),s&&typeof s=="object"&&"response"in s){const t=s;r.value=t.response?.data?.error||"Failed to start checkout"}else r.value="Failed to start checkout";l.value=!1}}return W(async()=>{await F();const s=new URLSearchParams(window.location.search);s.get("success")==="true"?await F():s.get("cancelled")==="true"&&(r.value="Checkout was cancelled"),(s.has("success")||s.has("cancelled"))&&window.history.replaceState({},"",window.location.pathname)}),(s,t)=>(u(),p("div",null,[t[18]||(t[18]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Billing & Subscription"),e("p",{class:"text-gray-600 mt-1"},"Manage your subscription plan and payment methods")],-1)),r.value?(u(),V(v(X),{key:0,severity:"error",class:"mb-6"},{default:m(()=>[o(g(r.value),1)]),_:1})):k("",!0),i.value?(u(),p("div",oe,[...t[0]||(t[0]=[e("i",{class:"pi pi-spin pi-spinner text-4xl text-violet-600"},null,-1),e("p",{class:"text-gray-600 mt-4"},"Loading subscription information...",-1)])])):!a.value||C.value?(u(),p("div",ce,[x(v(E),{class:"shadow-sm"},{title:m(()=>[...t[1]||(t[1]=[o("Start Your Subscription",-1)])]),content:m(()=>[e("div",ue,[t[6]||(t[6]=e("i",{class:"pi pi-credit-card text-6xl text-gray-300 mb-4"},null,-1)),t[7]||(t[7]=e("h3",{class:"text-xl font-bold text-gray-900 mb-2"},"No Active Subscription",-1)),e("p",de,g(C.value?"Your trial has ended. Subscribe now to continue using TONRIS.":"Subscribe to get started with TONRIS AI Assistant."),1),e("div",pe,[e("div",me,[t[3]||(t[3]=e("h3",{class:"text-xl font-bold text-gray-900 mb-1"},"Monthly Plan",-1)),t[4]||(t[4]=e("p",{class:"text-gray-500 text-sm mb-4"},"Cancel anytime. No long-term contracts required.",-1)),e("div",ve,[e("span",ge,"$"+g(N.value),1),t[2]||(t[2]=e("span",{class:"text-gray-500"},"/month",-1))]),t[5]||(t[5]=e("ul",{class:"space-y-2 mb-6 text-left"},[e("li",{class:"flex items-start text-sm text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2 mt-0.5"}),o(" Unlimited calls ")]),e("li",{class:"flex items-start text-sm text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2 mt-0.5"}),o(" 24/7 AI answering ")]),e("li",{class:"flex items-start text-sm text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2 mt-0.5"}),o(" Appointment booking ")]),e("li",{class:"flex items-start text-sm text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2 mt-0.5"}),o(" Calendar integration ")]),e("li",{class:"flex items-start text-sm text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2 mt-0.5"}),o(" Email notifications ")]),e("li",{class:"flex items-start text-sm text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2 mt-0.5"}),o(" Basic analytics ")])],-1)),x(v(_),{label:"Subscribe Now",icon:"pi pi-credit-card",class:"w-full",loading:l.value,onClick:J},null,8,["loading"])])])])]),_:1})])):(u(),p("div",xe,[x(v(E),{class:"shadow-sm lg:col-span-2"},{title:m(()=>[e("div",fe,[t[8]||(t[8]=e("span",null,"Current Subscription",-1)),e("span",{class:Y(["px-3 py-1 rounded-full text-sm font-medium",z(a.value.status)])},g(q.value),3)])]),content:m(()=>[b.value?(u(),p("div",ye,[e("div",be,[t[10]||(t[10]=e("i",{class:"pi pi-info-circle text-blue-600 text-xl mr-3 mt-0.5"},null,-1)),e("div",null,[t[9]||(t[9]=e("h4",{class:"font-medium text-blue-900 mb-1"},"Free Trial Active",-1)),e("p",he," Your "+g(d.value)+"-day free trial ends on "+g(R(a.value.trialEnd))+". Add a payment method to continue your service after the trial. ",1)])])])):k("",!0),e("div",we,[e("div",null,[t[11]||(t[11]=e("h3",{class:"text-2xl font-bold text-gray-900"},"Professional Plan",-1)),e("p",Se," $"+g(N.value)+"/month ",1)]),a.value.currentPeriodEnd&&y.value?(u(),p("div",ke,[e("p",Ee,g(a.value.cancelAtPeriodEnd?"Ends on":"Next billing date"),1),e("p",_e,g(R(a.value.currentPeriodEnd)),1)])):k("",!0)]),t[12]||(t[12]=e("div",{class:"border-t border-gray-200 pt-4"},[e("h4",{class:"font-medium text-gray-900 mb-3"},"Plan Features"),e("ul",{class:"grid grid-cols-1 md:grid-cols-2 gap-2"},[e("li",{class:"flex items-center text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2"}),o(" Unlimited calls ")]),e("li",{class:"flex items-center text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2"}),o(" 24/7 AI answering ")]),e("li",{class:"flex items-center text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2"}),o(" Appointment booking ")]),e("li",{class:"flex items-center text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2"}),o(" Calendar integration ")]),e("li",{class:"flex items-center text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2"}),o(" Email notifications ")]),e("li",{class:"flex items-center text-gray-600"},[e("i",{class:"pi pi-check text-green-500 mr-2"}),o(" Basic analytics ")])])],-1)),e("div",Pe,[x(v(_),{label:"Manage in Stripe",icon:"pi pi-external-link",loading:l.value,onClick:L},null,8,["loading"])])]),_:1}),x(v(E),{class:"shadow-sm"},{title:m(()=>[...t[13]||(t[13]=[o("Payment Method",-1)])]),content:m(()=>[b.value?(u(),p("div",je,[...t[14]||(t[14]=[e("i",{class:"pi pi-credit-card text-4xl text-gray-300 mb-3"},null,-1),e("p",{class:"text-sm text-gray-600 mb-4"}," No payment method on file. Add one before your trial ends. ",-1)])])):y.value?(u(),p("div",Ce,[...t[15]||(t[15]=[e("i",{class:"pi pi-credit-card text-4xl text-green-500 mb-3"},null,-1),e("p",{class:"text-sm text-gray-600 mb-4"}," Payment method is on file and managed through Stripe. ",-1)])])):(u(),p("div",Le," No payment method on file ")),x(v(_),{label:"Manage Payment Method",icon:"pi pi-credit-card",outlined:"",class:"w-full",loading:l.value,onClick:L},null,8,["loading"])]),_:1})])),a.value&&!C.value?(u(),V(v(E),{key:4,class:"shadow-sm mt-6"},{title:m(()=>[e("div",Ae,[t[16]||(t[16]=e("span",null,"Billing History",-1)),x(v(_),{label:"View All in Stripe",text:"",size:"small",loading:l.value,onClick:L},null,8,["loading"])])]),content:m(()=>[...t[17]||(t[17]=[e("div",{class:"text-center py-8 text-gray-500"}," View your complete billing history in the Stripe customer portal. ",-1)])]),_:1})):k("",!0)]))}});export{Te as default};
