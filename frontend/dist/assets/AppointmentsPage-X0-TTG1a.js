import{d as se,i as m,E as T,j as ae,z as _,c as D,a as l,e as o,u as a,g as w,w as r,s as p,o as v,t as u,k as L,l as P,F as oe,r as ne,n as j,q as S,I as ie,f as re,m as ue,S as de}from"./index-Gs8EthlX.js";import{a as me,b as ce}from"./index-Ck1sxs7k.js";import{s as N}from"./index-CQUG145c.js";import{s as J}from"./index-DNXU_T83.js";import{s as pe,a as V}from"./index-D3hXdzxh.js";import{s as ve}from"./index-DZoqFwy1.js";import{s as fe,a as Q}from"./index-DaIRSQcz.js";import"./index-C-5KtboR.js";import"./index-QPNBdbY6.js";import"./index-CjsVE6iW.js";const ge={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},we={class:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6"},be={class:"text-center"},xe={class:"text-3xl font-bold text-violet-600"},ye={class:"text-center"},he={class:"text-3xl font-bold text-blue-600"},Ve={class:"text-center"},ke={class:"text-3xl font-bold text-green-600"},Me={class:"text-center"},_e={class:"text-3xl font-bold text-red-600"},De={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Pe={class:"text-gray-900"},Se={class:"space-y-3"},Ne={class:"flex items-center space-x-4"},Ce={class:"text-center min-w-[60px]"},Ae={class:"text-lg font-bold text-violet-600"},Ee={class:"font-medium text-gray-900"},$e={class:"text-sm text-gray-600"},Ue={class:"flex items-center space-x-2"},Ie={key:0,class:"text-center py-8 text-white-500"},Te={class:"flex flex-col sm:flex-row gap-4"},Le={class:"flex-1"},Fe={class:"font-medium text-white-900"},Oe={class:"text-sm text-white-600"},ze={class:"font-medium text-white-900"},He={class:"text-sm text-white-600"},Be={class:"flex gap-1"},qe={class:"space-y-4"},je={class:"grid grid-cols-2 gap-4"},Je={class:"col-span-2"},Qe={class:"grid grid-cols-2 gap-4"},We={class:"grid grid-cols-2 gap-4"},Ge={key:0},nt=se({__name:"AppointmentsPage",setup(Ke){const k=m(!1),b=m([]),x=m(""),d=m(null),y=m(null),f=m(!1),h=m(!1),c=m(""),C=m([]),A=m([]),F=[{label:"All Statuses",value:null},{label:"Scheduled",value:"scheduled"},{label:"Confirmed",value:"confirmed"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],W=["8:00 AM","8:30 AM","9:00 AM","9:30 AM","10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM"],O={id:"",customerName:"",customerEmail:"",customerPhone:"",service:"",employee:"",date:new Date,time:"9:00 AM",duration:45,status:"scheduled",notes:""},n=m({...O}),E=T(()=>{let s=b.value;if(x.value){const e=x.value.toLowerCase();s=s.filter(i=>i.customerName.toLowerCase().includes(e)||i.customerEmail.toLowerCase().includes(e)||i.service.toLowerCase().includes(e)||i.employee.toLowerCase().includes(e))}if(d.value){const e=d.value.toDateString();s=s.filter(i=>new Date(i.date).toDateString()===e)}return y.value&&(s=s.filter(e=>e.status===y.value)),s}),$=T(()=>{const s=new Date().toDateString();return b.value.filter(e=>new Date(e.date).toDateString()===s)}),G=T(()=>{const s=new Date;return s.setHours(0,0,0,0),b.value.filter(e=>new Date(e.date)>=s&&e.status!=="completed"&&e.status!=="cancelled").sort((e,i)=>new Date(e.date).getTime()-new Date(i.date).getTime())});function z(s){return new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}function H(s){return{scheduled:"bg-blue-100 text-blue-700",confirmed:"bg-green-100 text-green-700",completed:"bg-gray-100 text-gray-700",cancelled:"bg-red-100 text-red-700","no-show":"bg-orange-100 text-orange-700"}[s]||"bg-gray-100 text-gray-700"}function K(){n.value={...O,id:crypto.randomUUID(),date:new Date},h.value=!1,f.value=!0,c.value=""}function B(s){n.value={...s,date:new Date(s.date)},h.value=!0,f.value=!0,c.value=""}async function R(){if(!n.value.customerName||!n.value.service||!n.value.employee){c.value="Please fill in all required fields";return}try{k.value=!0,c.value="";const s=A.value.find(t=>t.value===n.value.service),e=C.value.find(t=>t.value===n.value.employee);if(!s||!e){c.value="Invalid service or employee selection";return}const i=X(n.value.date,n.value.time);if(h.value){const t={customerName:n.value.customerName,customerEmail:n.value.customerEmail||void 0,customerPhone:n.value.customerPhone||void 0,employeeId:e.id,startTime:i.toISOString(),notes:n.value.notes||void 0,status:n.value.status,tenantId:Y()};(await _.patch(`/api/appointments/${n.value.id}`,t)).data.success&&(await U(),f.value=!1)}else{const t={customerName:n.value.customerName,customerEmail:n.value.customerEmail||void 0,customerPhone:n.value.customerPhone||void 0,serviceId:s.id,employeeId:e.id,startTime:i.toISOString(),notes:n.value.notes||void 0,addOns:[]};(await _.post("/api/appointments",t)).data.success&&(await U(),f.value=!1)}}catch(s){console.error("Error saving appointment:",s),c.value=s.response?.data?.error||"Failed to save appointment"}finally{k.value=!1}}function X(s,e){const i=e.split(" "),t=i[0],g=i[1];if(!t)throw new Error("Time must be in format HH:MM AM/PM (e.g., 9:00 AM)");const I=t.split(":");if(I.length!==2)throw new Error("Time must be in format HH:MM AM/PM (e.g., 9:00 AM)");let M=parseInt(I[0]||"0",10);const le=parseInt(I[1]||"0",10);g==="PM"&&M!==12?M+=12:g==="AM"&&M===12&&(M=0);const q=new Date(s);return q.setHours(M,le,0,0),q}function Y(){const s=localStorage.getItem("token");if(!s)return null;try{const e=s.split(".");if(e.length!==3||!e[1])return null;let i=e[1].replace(/-/g,"+").replace(/_/g,"/");const t=(4-i.length%4)%4;return i=i.padEnd(i.length+t,"="),JSON.parse(atob(i)).tenantId||null}catch(e){return console.error("Error parsing JWT token:",e),null}}function Z(){x.value="",d.value=null,y.value=null}ae(async()=>{k.value=!0;try{await Promise.all([U(),ee(),te()])}catch(s){console.error("Error loading data:",s),c.value="Failed to load appointments data"}finally{k.value=!1}});async function U(){try{const s=await _.get("/api/appointments");s.data.success&&s.data.data&&(b.value=s.data.data.appointments.map(e=>({id:e.id,customerName:e.customerName||"Unknown",customerEmail:e.customerEmail||"",customerPhone:e.customerPhone||"",service:e.service?.name||"Unknown Service",serviceId:e.serviceId,employee:e.employee?`${e.employee.firstName} ${e.employee.lastName}`:"Unknown",employeeId:e.employeeId,date:new Date(e.startTime),time:new Date(e.startTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),duration:e.duration||e.totalDuration||30,status:e.status||"scheduled",notes:e.notes||""})))}catch(s){console.error("Error fetching appointments:",s)}}async function ee(){try{const s=await _.get("/api/employees");s.data.success&&s.data.data&&(C.value=s.data.data.employees.map(e=>({label:`${e.firstName} ${e.lastName}`,value:`${e.firstName} ${e.lastName}`,id:e.id})))}catch(s){console.error("Error fetching employees:",s)}}async function te(){try{const s=await _.get("/api/services");s.data.success&&s.data.data&&(A.value=s.data.data.services.map(e=>({label:e.name,value:e.name,id:e.id,duration:e.duration})))}catch(s){console.error("Error fetching services:",s)}}return(s,e)=>{const i=de("tooltip");return v(),D("div",null,[l("div",ge,[e[15]||(e[15]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900"},"Appointments"),l("p",{class:"text-gray-600 mt-1"},"Manage your appointments calendar and bookings")],-1)),o(a(w),{label:"New Appointment",icon:"pi pi-plus",class:"mt-4 sm:mt-0",onClick:K})]),l("div",we,[o(a(p),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",be,[l("p",xe,u($.value.length),1),e[16]||(e[16]=l("p",{class:"text-sm text-white-600"},"Today",-1))])]),_:1}),o(a(p),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",ye,[l("p",he,u(G.value.length),1),e[17]||(e[17]=l("p",{class:"text-sm text-white-600"},"Upcoming",-1))])]),_:1}),o(a(p),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",Ve,[l("p",ke,u(b.value.filter(t=>t.status==="completed").length),1),e[18]||(e[18]=l("p",{class:"text-sm text-white-600"},"Completed",-1))])]),_:1}),o(a(p),{class:"shadow-sm bg-white"},{content:r(()=>[l("div",Me,[l("p",_e,u(b.value.filter(t=>t.status==="cancelled").length),1),e[19]||(e[19]=l("p",{class:"text-sm text-white-600"},"Cancelled",-1))])]),_:1})]),o(a(fe),null,{default:r(()=>[o(a(Q),{value:"0",header:"Calendar View"},{default:r(()=>[l("div",De,[o(a(p),{class:"shadow-sm bg-white"},{content:r(()=>[o(a(J),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),inline:"",class:"w-full",manualInput:!1},null,8,["modelValue"]),d.value?(v(),L(a(w),{key:0,label:"Clear Date",text:"",size:"small",class:"mt-2 w-full text-emerald-600",onClick:e[1]||(e[1]=t=>d.value=null)})):P("",!0)]),_:1}),o(a(p),{class:"shadow-sm lg:col-span-2 bg-white"},{title:r(()=>[l("span",Pe,u(d.value?z(d.value):"Today's")+" Appointments",1)]),content:r(()=>[l("div",Se,[(v(!0),D(oe,null,ne(d.value?E.value:$.value,t=>(v(),D("div",{key:t.id,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[l("div",Ne,[l("div",Ce,[l("p",Ae,u(t.time),1)]),l("div",null,[l("p",Ee,u(t.customerName),1),l("p",$e,u(t.service)+" with "+u(t.employee),1)])]),l("div",Ue,[l("span",{class:j(["px-2 py-1 rounded-full text-xs font-medium",H(t.status)])},u(t.status),3),o(a(w),{icon:"pi pi-pencil",text:"",size:"small",severity:"secondary",onClick:g=>B(t)},null,8,["onClick"])])]))),128)),(d.value?E.value:$.value).length===0?(v(),D("div",Ie," No appointments for this day ")):P("",!0)])]),_:1})])]),_:1}),o(a(Q),{value:"1",header:"List View"},{default:r(()=>[o(a(p),{class:"mb-6 shadow-sm bg-white"},{content:r(()=>[l("div",Te,[l("div",Le,[o(a(me),null,{default:r(()=>[o(a(ce),{class:"pi pi-search"}),o(a(S),{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=t=>x.value=t),placeholder:"Search appointments...",class:"w-full"},null,8,["modelValue"])]),_:1})]),o(a(N),{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),options:F,optionLabel:"label",optionValue:"value",placeholder:"Filter by status",class:"w-full sm:w-48"},null,8,["modelValue"]),x.value||y.value?(v(),L(a(w),{key:0,label:"Clear",text:"",severity:"secondary",onClick:Z})):P("",!0)])]),_:1}),o(a(p),{class:"shadow-sm bg-white"},{content:r(()=>[o(a(pe),{value:E.value,loading:k.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20],responsiveLayout:"scroll",class:"p-datatable-sm",sortField:"date",sortOrder:-1},{empty:r(()=>[...e[20]||(e[20]=[l("div",{class:"text-center py-8 text-white-500"}," No appointments found ",-1)])]),default:r(()=>[o(a(V),{field:"date",header:"Date",sortable:""},{body:r(({data:t})=>[l("div",null,[l("p",Fe,u(z(t.date)),1),l("p",Oe,u(t.time),1)])]),_:1}),o(a(V),{field:"customerName",header:"Customer",sortable:""},{body:r(({data:t})=>[l("div",null,[l("p",ze,u(t.customerName),1),l("p",He,u(t.customerPhone),1)])]),_:1}),o(a(V),{field:"service",header:"Service",sortable:""}),o(a(V),{field:"employee",header:"Employee",sortable:""}),o(a(V),{field:"status",header:"Status",sortable:""},{body:r(({data:t})=>[l("span",{class:j(["px-2 py-1 rounded-full text-xs font-medium capitalize",H(t.status)])},u(t.status),3)]),_:1}),o(a(V),{header:"Edit",exportable:!1,style:{"min-width":"12rem"}},{body:r(({data:t})=>[l("div",Be,[ie(o(a(w),{icon:"pi pi-pencil",text:"",size:"small",severity:"secondary",onClick:g=>B(t)},null,8,["onClick"]),[[i,"Edit",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),_:1})]),_:1})]),_:1}),o(a(ve),{visible:f.value,"onUpdate:visible":e[14]||(e[14]=t=>f.value=t),header:h.value?"Edit Appointment":"New Appointment",modal:!0,style:{width:"600px"}},{footer:r(()=>[o(a(w),{label:"Cancel",text:"",severity:"secondary",onClick:e[13]||(e[13]=t=>f.value=!1)}),o(a(w),{label:h.value?"Update":"Book",onClick:R},null,8,["label"])]),default:r(()=>[c.value?(v(),L(a(ue),{key:0,severity:"error",class:"mb-4"},{default:r(()=>[re(u(c.value),1)]),_:1})):P("",!0),l("div",qe,[l("div",je,[l("div",Je,[e[21]||(e[21]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Customer Name *",-1)),o(a(S),{modelValue:n.value.customerName,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.customerName=t),class:"w-full"},null,8,["modelValue"])]),l("div",null,[e[22]||(e[22]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Email",-1)),o(a(S),{modelValue:n.value.customerEmail,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.customerEmail=t),type:"email",class:"w-full"},null,8,["modelValue"])]),l("div",null,[e[23]||(e[23]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Phone",-1)),o(a(S),{modelValue:n.value.customerPhone,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.customerPhone=t),class:"w-full"},null,8,["modelValue"])])]),l("div",Qe,[l("div",null,[e[24]||(e[24]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Service *",-1)),o(a(N),{modelValue:n.value.service,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.service=t),options:A.value,optionLabel:"label",optionValue:"value",placeholder:"Select service",class:"w-full"},null,8,["modelValue","options"])]),l("div",null,[e[25]||(e[25]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Employee *",-1)),o(a(N),{modelValue:n.value.employee,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.employee=t),options:C.value,optionLabel:"label",optionValue:"value",placeholder:"Select employee",class:"w-full"},null,8,["modelValue","options"])])]),l("div",We,[l("div",null,[e[26]||(e[26]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Date *",-1)),o(a(J),{modelValue:n.value.date,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.date=t),class:"w-full",dateFormat:"mm/dd/yy"},null,8,["modelValue"])]),l("div",null,[e[27]||(e[27]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Time *",-1)),o(a(N),{modelValue:n.value.time,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.time=t),options:W,placeholder:"Select time",class:"w-full"},null,8,["modelValue"])])]),h.value?(v(),D("div",Ge,[e[28]||(e[28]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Status",-1)),o(a(N),{modelValue:n.value.status,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.status=t),options:F.filter(t=>t.value),optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"])])):P("",!0),l("div",null,[e[29]||(e[29]=l("label",{class:"block text-sm font-medium text-white-700 mb-1"},"Notes",-1)),o(a(S),{modelValue:n.value.notes,"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.notes=t),class:"w-full",placeholder:"Any special requests or notes..."},null,8,["modelValue"])])])]),_:1},8,["visible","header"])])}}});export{nt as default};
