import{d as z,i as g,E as W,j as K,z as L,c as k,a as e,k as G,l as J,e as n,u as a,g as Q,w as r,s as d,o as y,t as i,n as V,f as C,F as X,r as Y}from"./index-DGgEdFeZ.js";import{s as Z}from"./index-Dt3p5Ncx.js";import{s as tt}from"./index-kzxRjlIQ.js";import{s as $,a as u}from"./index-e2zfaVt4.js";import{s as et,a as M}from"./index-PmaDM6rX.js";import"./index-XTFs8Az5.js";import"./index-xB9YFVhr.js";import"./index-BqBm8Fgu.js";import"./index-wvJAu5ZM.js";const st={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},ot={class:"mt-4 sm:mt-0 flex gap-2"},at={class:"flex items-center gap-4"},lt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6"},nt={class:"text-center"},rt={class:"text-3xl font-bold text-violet-600"},it={class:"text-center"},dt={class:"text-3xl font-bold text-cyan-600"},ct={class:"text-center"},ut={class:"text-3xl font-bold text-green-600"},mt={class:"text-center"},pt={class:"text-3xl font-bold text-blue-600"},xt={class:"text-center"},gt={class:"text-3xl font-bold text-red-600"},ft={class:"text-center"},vt={class:"text-3xl font-bold text-orange-600"},_t={class:"text-gray-500 text-sm"},bt={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},yt={class:"text-center p-4 bg-green-50 rounded-lg"},ht={class:"text-2xl font-bold text-green-600"},wt={class:"text-center p-4 bg-blue-50 rounded-lg"},kt={class:"text-2xl font-bold text-blue-600"},Ct={class:"text-center p-4 bg-yellow-50 rounded-lg"},St={class:"text-2xl font-bold text-yellow-600"},Dt={class:"text-center p-4 bg-purple-50 rounded-lg"},Nt={class:"text-2xl font-bold text-purple-600"},Lt={class:"text-center p-4 bg-red-50 rounded-lg"},Vt={class:"text-2xl font-bold text-red-600"},$t={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Mt={class:"font-medium text-blue-600"},Ot={class:"font-medium text-green-600"},At={class:"font-medium text-red-600"},Bt={class:"font-medium text-orange-600"},Et={class:"space-y-4"},Tt={class:"flex items-center"},Rt={class:"w-6 h-6 rounded-full bg-violet-100 text-violet-600 flex items-center justify-center text-sm font-medium mr-3"},Pt={class:"font-medium text-gray-900"},qt={class:"text-sm text-gray-500"},jt={class:"font-medium text-green-600"},Ft={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6"},Ut={class:"text-center"},Ht={class:"text-3xl font-bold text-blue-600"},It={class:"text-center"},zt={class:"text-3xl font-bold text-green-600"},Wt={class:"text-center"},Kt={class:"text-3xl font-bold text-red-600"},Gt={class:"text-center"},Jt={class:"text-3xl font-bold text-orange-600"},ne=z({__name:"ReportsPage",setup(Qt){const h=g(!1),S=g(null),w=g("last30days"),O=[{label:"Last 7 days",value:"last7days"},{label:"Last 30 days",value:"last30days"},{label:"Last 90 days",value:"last90days"},{label:"This month",value:"thisMonth"},{label:"Last month",value:"lastMonth"},{label:"Custom range",value:"custom"}],c=g({totalCalls:0,avgCallDuration:0,appointmentsBooked:0,conversionRate:0,missedCalls:0,peakHour:"N/A"}),b=g([]),f=g([]),D=g([]),v=W(()=>{const o={appointment_booked:0,inquiry:0,voicemail:0,transferred:0,missed:0};return b.value.forEach(t=>{o[t.outcome]++}),o});function N(o){if(o===0)return"-";const t=Math.floor(o/60),s=o%60;return`${t}:${s.toString().padStart(2,"0")}`}function A(o){return new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}function B(o){return`$${o.toLocaleString()}`}function E(o){return{appointment_booked:"bg-green-100 text-green-700",inquiry:"bg-blue-100 text-blue-700",voicemail:"bg-yellow-100 text-yellow-700",transferred:"bg-purple-100 text-purple-700",missed:"bg-red-100 text-red-700"}[o]||"bg-gray-100 text-gray-700"}function T(o){return{appointment_booked:"Appointment Booked",inquiry:"Inquiry",voicemail:"Voicemail",transferred:"Transferred",missed:"Missed"}[o]||o}function R(){alert("Report export functionality would be implemented here")}K(async()=>{h.value=!0;try{await Promise.all([P(),q()])}catch(o){console.error("Error loading reports:",o)}finally{h.value=!1}});async function P(){try{const o=await L.get("/api/telephony/call-logs");o.data.success&&o.data.data&&(b.value=o.data.data.map(t=>({id:t.id,phoneNumber:t.fromNumber||t.toNumber||"Unknown",callerName:t.callerName||"Unknown",date:new Date(t.createdAt),duration:t.duration||0,outcome:j(t.status),notes:t.notes||""})),F())}catch(o){console.error("Error fetching call logs:",o)}}async function q(){try{const o=await L.get("/api/appointments");o.data.success&&o.data.data&&(U(o.data.data),H(o.data.data))}catch(o){console.error("Error fetching appointment stats:",o)}}function j(o){return{completed:"appointment_booked","in-progress":"inquiry",busy:"missed","no-answer":"missed",failed:"missed",voicemail:"voicemail"}[o]||"inquiry"}function F(){const o=b.value;if(c.value.totalCalls=o.length,o.length>0){const t=o.reduce((m,x)=>m+x.duration,0);c.value.avgCallDuration=Math.round(t/o.length),c.value.appointmentsBooked=o.filter(m=>m.outcome==="appointment_booked").length,c.value.conversionRate=parseFloat((c.value.appointmentsBooked/o.length*100).toFixed(1)),c.value.missedCalls=o.filter(m=>m.outcome==="missed").length;const s={};o.forEach(m=>{const x=new Date(m.date).getHours();s[x]=(s[x]||0)+1});let l=0,_=0;Object.entries(s).forEach(([m,x])=>{x>_&&(_=x,l=parseInt(m))});const p=l>12?l-12:l===0?12:l,I=l>=12?"PM":"AM";c.value.peakHour=`${p}:00 ${I}`}}function U(o){const t={};o.forEach(s=>{const l=new Date(s.startTime),_=new Date(l);_.setDate(l.getDate()-l.getDay());const p=_.toISOString().split("T")[0];t[p]||(t[p]={booked:0,completed:0,cancelled:0,noShow:0}),t[p].booked++,s.status==="completed"&&t[p].completed++,s.status==="cancelled"&&t[p].cancelled++,s.status==="no-show"&&t[p].noShow++}),f.value=Object.entries(t).sort(([s],[l])=>s.localeCompare(l)).slice(-4).map(([,s],l)=>({period:`Week ${l+1}`,...s}))}function H(o){const t={};o.forEach(s=>{const l=s.service?.name||"Unknown";t[l]||(t[l]={count:0,revenue:0}),t[l].count++,t[l].revenue+=s.service?.price||0}),D.value=Object.entries(t).map(([s,l])=>({name:s,...l})).sort((s,l)=>l.count-s.count).slice(0,5)}return(o,t)=>(y(),k("div",null,[e("div",st,[t[2]||(t[2]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Reports"),e("p",{class:"text-gray-600 mt-1"},"View call logs, statistics, and appointment analytics")],-1)),e("div",ot,[n(a(Z),{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s),options:O,optionLabel:"label",optionValue:"value",class:"w-40"},null,8,["modelValue"]),n(a(Q),{label:"Export",icon:"pi pi-download",outlined:"",onClick:R})])]),w.value==="custom"?(y(),G(a(d),{key:0,class:"mb-6 shadow-sm"},{content:r(()=>[e("div",at,[t[3]||(t[3]=e("label",{class:"text-sm font-medium text-gray-700"},"Date Range:",-1)),n(a(tt),{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=s=>S.value=s),selectionMode:"range",dateFormat:"mm/dd/yy",placeholder:"Select date range",class:"w-64"},null,8,["modelValue"])])]),_:1})):J("",!0),e("div",lt,[n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",nt,[e("p",rt,i(c.value.totalCalls),1),t[4]||(t[4]=e("p",{class:"text-sm text-gray-500"},"Total Calls",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",it,[e("p",dt,i(N(c.value.avgCallDuration)),1),t[5]||(t[5]=e("p",{class:"text-sm text-gray-500"},"Avg Duration",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",ct,[e("p",ut,i(c.value.appointmentsBooked),1),t[6]||(t[6]=e("p",{class:"text-sm text-gray-500"},"Appointments",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",mt,[e("p",pt,i(c.value.conversionRate)+"%",1),t[7]||(t[7]=e("p",{class:"text-sm text-gray-500"},"Conversion Rate",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",xt,[e("p",gt,i(c.value.missedCalls),1),t[8]||(t[8]=e("p",{class:"text-sm text-gray-500"},"Missed Calls",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",ft,[e("p",vt,i(c.value.peakHour),1),t[9]||(t[9]=e("p",{class:"text-sm text-gray-500"},"Peak Hour",-1))])]),_:1})]),n(a(et),null,{default:r(()=>[n(a(M),{value:"0",header:"Call Logs"},{default:r(()=>[n(a(d),{class:"shadow-sm"},{content:r(()=>[n(a($),{value:b.value,loading:h.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20],responsiveLayout:"scroll",class:"p-datatable-sm",sortField:"date",sortOrder:-1},{empty:r(()=>[...t[10]||(t[10]=[e("div",{class:"text-center py-8 text-gray-500"}," No call logs found ",-1)])]),default:r(()=>[n(a(u),{field:"date",header:"Date/Time",sortable:""},{body:r(({data:s})=>[e("span",null,i(A(s.date)),1)]),_:1}),n(a(u),{field:"phoneNumber",header:"Phone",sortable:""}),n(a(u),{field:"callerName",header:"Caller",sortable:""},{body:r(({data:s})=>[e("span",{class:V(s.callerName==="Unknown"?"text-gray-400":"")},i(s.callerName),3)]),_:1}),n(a(u),{field:"duration",header:"Duration",sortable:""},{body:r(({data:s})=>[e("span",null,i(N(s.duration)),1)]),_:1}),n(a(u),{field:"outcome",header:"Outcome",sortable:""},{body:r(({data:s})=>[e("span",{class:V(["px-2 py-1 rounded-full text-xs font-medium",E(s.outcome)])},i(T(s.outcome)),3)]),_:1}),n(a(u),{field:"notes",header:"Notes"},{body:r(({data:s})=>[e("span",_t,i(s.notes||"-"),1)]),_:1})]),_:1},8,["value","loading"])]),_:1}),n(a(d),{class:"shadow-sm mt-6"},{title:r(()=>[...t[11]||(t[11]=[C("Call Outcome Distribution",-1)])]),content:r(()=>[e("div",bt,[e("div",yt,[e("p",ht,i(v.value.appointment_booked),1),t[12]||(t[12]=e("p",{class:"text-sm text-gray-600"},"Appointments Booked",-1))]),e("div",wt,[e("p",kt,i(v.value.inquiry),1),t[13]||(t[13]=e("p",{class:"text-sm text-gray-600"},"Inquiries",-1))]),e("div",Ct,[e("p",St,i(v.value.voicemail),1),t[14]||(t[14]=e("p",{class:"text-sm text-gray-600"},"Voicemails",-1))]),e("div",Dt,[e("p",Nt,i(v.value.transferred),1),t[15]||(t[15]=e("p",{class:"text-sm text-gray-600"},"Transferred",-1))]),e("div",Lt,[e("p",Vt,i(v.value.missed),1),t[16]||(t[16]=e("p",{class:"text-sm text-gray-600"},"Missed",-1))])])]),_:1})]),_:1}),n(a(M),{value:"1",header:"Appointment Analytics"},{default:r(()=>[e("div",$t,[n(a(d),{class:"shadow-sm"},{title:r(()=>[...t[17]||(t[17]=[C("Weekly Appointment Statistics",-1)])]),content:r(()=>[n(a($),{value:f.value,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:r(()=>[n(a(u),{field:"period",header:"Period"}),n(a(u),{field:"booked",header:"Booked"},{body:r(({data:s})=>[e("span",Mt,i(s.booked),1)]),_:1}),n(a(u),{field:"completed",header:"Completed"},{body:r(({data:s})=>[e("span",Ot,i(s.completed),1)]),_:1}),n(a(u),{field:"cancelled",header:"Cancelled"},{body:r(({data:s})=>[e("span",At,i(s.cancelled),1)]),_:1}),n(a(u),{field:"noShow",header:"No Show"},{body:r(({data:s})=>[e("span",Bt,i(s.noShow),1)]),_:1})]),_:1},8,["value"])]),_:1}),n(a(d),{class:"shadow-sm"},{title:r(()=>[...t[18]||(t[18]=[C("Top Services",-1)])]),content:r(()=>[e("div",Et,[(y(!0),k(X,null,Y(D.value,(s,l)=>(y(),k("div",{key:s.name,class:"flex items-center justify-between"},[e("div",Tt,[e("span",Rt,i(l+1),1),e("div",null,[e("p",Pt,i(s.name),1),e("p",qt,i(s.count)+" bookings",1)])]),e("span",jt,i(B(s.revenue)),1)]))),128))])]),_:1})]),e("div",Ft,[n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",Ut,[e("p",Ht,i(f.value.reduce((s,l)=>s+l.booked,0)),1),t[19]||(t[19]=e("p",{class:"text-sm text-gray-500"},"Total Booked",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",It,[e("p",zt,i(f.value.reduce((s,l)=>s+l.completed,0)),1),t[20]||(t[20]=e("p",{class:"text-sm text-gray-500"},"Completed",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",Wt,[e("p",Kt,i(f.value.reduce((s,l)=>s+l.cancelled,0)),1),t[21]||(t[21]=e("p",{class:"text-sm text-gray-500"},"Cancelled",-1))])]),_:1}),n(a(d),{class:"shadow-sm"},{content:r(()=>[e("div",Gt,[e("p",Jt,i(f.value.reduce((s,l)=>s+l.noShow,0)),1),t[22]||(t[22]=e("p",{class:"text-sm text-gray-500"},"No Shows",-1))])]),_:1})])]),_:1})]),_:1})]))}});export{ne as default};
